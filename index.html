<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PRIN 3D - Gerador de Orçamentos</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            border-radius: 5px;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #eee;
            padding-bottom: 20px;
        }
        .logo-container {
            text-align: center;
        }
        .logo-preview {
            max-width: 150px;
            max-height: 100px;
            margin-bottom: 10px;
        }
        .company-info {
            text-align: right;
        }
        h1 {
            color: #2c3e50;
            margin: 0;
        }
        .contact {
            font-size: 14px;
            color: #7f8c8d;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, textarea, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        textarea {
            resize: vertical;
            min-height: 60px;
        }
        .items-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .items-table th, .items-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        .items-table th {
            background-color: #f2f2f2;
        }
        .add-item {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin-bottom: 20px;
        }
        .add-item:hover {
            background-color: #2980b9;
        }
        .remove-item {
            background-color: #e74c3c;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
        .total {
            font-size: 18px;
            font-weight: bold;
            text-align: right;
            margin-top: 10px;
        }
        .actions {
            margin-top: 20px;
            display: flex;
            gap: 10px;
        }
        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        .btn-pdf {
            background-color: #27ae60;
            color: white;
        }
        .btn-img {
            background-color: #3498db;
            color: white;
        }
        .btn-reset {
            background-color: #e67e22;
            color: white;
        }
        .btn:hover {
            opacity: 0.9;
        }
        #preview {
            margin-top: 30px;
            padding: 20px;
            background: white;
            border: 1px solid #ddd;
            display: none;
        }
        .preview-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        .preview-logo {
            max-width: 120px;
            max-height: 80px;
        }
        .preview-title {
            text-align: center;
            margin: 20px 0;
        }
        .preview-table {
            width: 100%;
            border-collapse: collapse;
        }
        .preview-table th, .preview-table td {
            border: 1px solid #ddd;
            padding: 8px;
        }
        .preview-table th {
            background-color: #f2f2f2;
        }
        .preview-total {
            font-weight: bold;
            text-align: right;
            margin-top: 20px;
        }
        .preview-footer {
            margin-top: 30px;
            padding-top: 10px;
            border-top: 1px solid #eee;
            font-size: 12px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo-container">
                <div id="logo-preview-container">
                    <img id="logo-preview" class="logo-preview" src="" alt="Logo" style="display: none;">
                </div>
                <input type="file" id="logo-upload" accept="image/*">
            </div>
            <div class="company-info">
                <h1>PRIN 3D</h1>
                <div class="contact">(83) 9 9910-1520</div>
            </div>
        </div>

        <div class="form-group">
            <label for="client-name">Cliente:</label>
            <input type="text" id="client-name" placeholder="Nome do cliente">
        </div>

        <div class="form-group">
            <label for="client-contact">Contato do Cliente:</label>
            <input type="text" id="client-contact" placeholder="Telefone/E-mail">
        </div>

        <h3>Itens do Orçamento</h3>
        <table class="items-table" id="items-table">
            <thead>
                <tr>
                    <th>Item</th>
                    <th>Descrição</th>
                    <th>Quantidade</th>
                    <th>Valor Unitário</th>
                    <th>Total</th>
                    <th>Ação</th>
                </tr>
            </thead>
            <tbody id="items-body">
                <tr>
                    <td><input type="text" class="item-name" placeholder="Nome do produto"></td>
                    <td><textarea class="item-description" placeholder="Descrição"></textarea></td>
                    <td><input type="number" class="item-quantity" min="1" value="1"></td>
                    <td><input type="number" class="item-price" min="0" step="0.01" placeholder="R$ 0,00"></td>
                    <td class="item-total">R$ 0,00</td>
                    <td><button class="remove-item">×</button></td>
                </tr>
            </tbody>
        </table>
        <button class="add-item" id="add-item">+ Adicionar Item</button>

        <div class="total" id="grand-total">Total: R$ 0,00</div>

        <div class="form-group">
            <label for="notes">Observações:</label>
            <textarea id="notes" placeholder="Termos, condições, prazos de entrega..."></textarea>
        </div>

        <div class="actions">
            <button class="btn btn-pdf" id="generate-pdf">Gerar PDF</button>
            <button class="btn btn-img" id="generate-img">Gerar Imagem</button>
            <button class="btn btn-reset" id="reset-form">Limpar Tudo</button>
        </div>
    </div>

    <div id="preview">
        <div class="preview-header">
            <div>
                <h2>PRIN 3D</h2>
                <div>Orçamento</div>
            </div>
            <div>
                <img id="preview-logo" class="preview-logo" src="" alt="Logo" style="display: none;">
            </div>
        </div>

        <div class="preview-info">
            <div><strong>Cliente:</strong> <span id="preview-client"></span></div>
            <div><strong>Contato:</strong> <span id="preview-contact"></span></div>
            <div><strong>Data:</strong> <span id="preview-date"></span></div>
        </div>

        <div class="preview-title">DETALHES DO ORÇAMENTO</div>

        <table class="preview-table" id="preview-table">
            <thead>
                <tr>
                    <th>Item</th>
                    <th>Descrição</th>
                    <th>Quantidade</th>
                    <th>Valor Unitário</th>
                    <th>Total</th>
                </tr>
            </thead>
            <tbody id="preview-items">
                <!-- Itens serão inseridos aqui -->
            </tbody>
        </table>

        <div class="preview-total" id="preview-grand-total">Total: R$ 0,00</div>

        <div class="preview-notes">
            <strong>Observações:</strong>
            <div id="preview-notes"></div>
        </div>

        <div class="preview-footer">
            PRIN 3D - (83) 9 9910-1520
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Referências aos elementos
            const itemsBody = document.getElementById('items-body');
            const addItemBtn = document.getElementById('add-item');
            const generatePdfBtn = document.getElementById('generate-pdf');
            const generateImgBtn = document.getElementById('generate-img');
            const resetFormBtn = document.getElementById('reset-form');
            const logoUpload = document.getElementById('logo-upload');
            const logoPreview = document.getElementById('logo-preview');
            const previewLogo = document.getElementById('preview-logo');
            
            // Adicionar novo item
            addItemBtn.addEventListener('click', function() {
                const newRow = document.createElement('tr');
                newRow.innerHTML = `
                    <td><input type="text" class="item-name" placeholder="Nome do produto"></td>
                    <td><textarea class="item-description" placeholder="Descrição"></textarea></td>
                    <td><input type="number" class="item-quantity" min="1" value="1"></td>
                    <td><input type="number" class="item-price" min="0" step="0.01" placeholder="R$ 0,00"></td>
                    <td class="item-total">R$ 0,00</td>
                    <td><button class="remove-item">×</button></td>
                `;
                itemsBody.appendChild(newRow);
                
                // Adicionar eventos aos novos inputs
                addItemEvents(newRow);
            });
            
            // Adicionar eventos aos itens existentes
            function addItemEvents(row) {
                const quantityInput = row.querySelector('.item-quantity');
                const priceInput = row.querySelector('.item-price');
                const totalCell = row.querySelector('.item-total');
                const removeBtn = row.querySelector('.remove-item');
                
                // Calcular total quando quantidade ou preço mudar
                function calculateItemTotal() {
                    const quantity = parseFloat(quantityInput.value) || 0;
                    const price = parseFloat(priceInput.value) || 0;
                    const total = quantity * price;
                    totalCell.textContent = 'R$ ' + total.toFixed(2).replace('.', ',');
                    calculateGrandTotal();
                    updatePreview();
                }
                
                quantityInput.addEventListener('input', calculateItemTotal);
                priceInput.addEventListener('input', calculateItemTotal);
                
                // Remover item
                removeBtn.addEventListener('click', function() {
                    row.remove();
                    calculateGrandTotal();
                    updatePreview();
                });
            }
            
            // Adicionar eventos aos itens iniciais
            document.querySelectorAll('#items-body tr').forEach(row => {
                addItemEvents(row);
            });
            
            // Calcular total geral
            function calculateGrandTotal() {
                let grandTotal = 0;
                document.querySelectorAll('.item-total').forEach(cell => {
                    const value = parseFloat(cell.textContent.replace('R$ ', '').replace(',', '.')) || 0;
                    grandTotal += value;
                });
                document.getElementById('grand-total').textContent = 'Total: R$ ' + grandTotal.toFixed(2).replace('.', ',');
            }
            
            // Upload da logo
            logoUpload.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        logoPreview.src = event.target.result;
                        logoPreview.style.display = 'block';
                        previewLogo.src = event.target.result;
                        previewLogo.style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            // Atualizar pré-visualização
            function updatePreview() {
                document.getElementById('preview-client').textContent = document.getElementById('client-name').value || '[Nome do Cliente]';
                document.getElementById('preview-contact').textContent = document.getElementById('client-contact').value || '[Contato]';
                
                const today = new Date();
                document.getElementById('preview-date').textContent = today.toLocaleDateString('pt-BR');
                
                const previewItems = document.getElementById('preview-items');
                previewItems.innerHTML = '';
                
                document.querySelectorAll('#items-body tr').forEach(row => {
                    const name = row.querySelector('.item-name').value || '[Item]';
                    const description = row.querySelector('.item-description').value || '[Descrição]';
                    const quantity = row.querySelector('.item-quantity').value || '0';
                    const price = parseFloat(row.querySelector('.item-price').value) || 0;
                    const total = parseFloat(row.querySelector('.item-total').textContent.replace('R$ ', '').replace(',', '.')) || 0;
                    
                    const newRow = document.createElement('tr');
                    newRow.innerHTML = `
                        <td>${name}</td>
                        <td>${description}</td>
                        <td>${quantity}</td>
                        <td>R$ ${price.toFixed(2).replace('.', ',')}</td>
                        <td>R$ ${total.toFixed(2).replace('.', ',')}</td>
                    `;
                    previewItems.appendChild(newRow);
                });
                
                document.getElementById('preview-grand-total').textContent = document.getElementById('grand-total').textContent;
                document.getElementById('preview-notes').textContent = document.getElementById('notes').value || 'Nenhuma observação.';
            }
            
            // Eventos para atualizar a pré-visualização
            document.getElementById('client-name').addEventListener('input', updatePreview);
            document.getElementById('client-contact').addEventListener('input', updatePreview);
            document.getElementById('notes').addEventListener('input', updatePreview);
            
            // Gerar PDF
            generatePdfBtn.addEventListener('click', function() {
                updatePreview();
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Adicionar conteúdo do preview ao PDF
                doc.html(document.getElementById('preview'), {
                    callback: function(doc) {
                        doc.save('Orcamento_PRIN3D.pdf');
                    },
                    x: 10,
                    y: 10,
                    width: 190,
                    windowWidth: 800
                });
            });
            
            // Gerar Imagem
            generateImgBtn.addEventListener('click', function() {
                updatePreview();
                html2canvas(document.getElementById('preview')).then(canvas => {
                    const link = document.createElement('a');
                    link.download = 'Orcamento_PRIN3D.png';
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                });
            });
            
            // Limpar formulário
            resetFormBtn.addEventListener('click', function() {
                if (confirm('Tem certeza que deseja limpar todo o orçamento?')) {
                    document.querySelector('form').reset();
                    itemsBody.innerHTML = `
                        <tr>
                            <td><input type="text" class="item-name" placeholder="Nome do produto"></td>
                            <td><textarea class="item-description" placeholder="Descrição"></textarea></td>
                            <td><input type="number" class="item-quantity" min="1" value="1"></td>
                            <td><input type="number" class="item-price" min="0" step="0.01" placeholder="R$ 0,00"></td>
                            <td class="item-total">R$ 0,00</td>
                            <td><button class="remove-item">×</button></td>
                        </tr>
                    `;
                    document.getElementById('grand-total').textContent = 'Total: R$ 0,00';
                    logoPreview.src = '';
                    logoPreview.style.display = 'none';
                    previewLogo.src = '';
                    previewLogo.style.display = 'none';
                    updatePreview();
                }
            });
            
            // Inicializar pré-visualização
            updatePreview();
        });
    </script>
</body>
</html>